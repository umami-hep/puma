
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the PUMA plotting framework">
      
      
        <meta name="author" content="Umami Team">
      
      
        <link rel="canonical" href="https://umami-hep.github.io/puma/examples/tutorial-plotting/">
      
      
        <link rel="prev" href="../../hlapi/yuma/">
      
      
        <link rel="next" href="../../dev/development_guidelines/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Tutorial - PUMA: Plotting UMami Api</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#puma-plotting-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PUMA: Plotting UMami Api" class="md-header__button md-logo" aria-label="PUMA: Plotting UMami Api" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PUMA: Plotting UMami Api
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/umami-hep/puma" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hlapi/" class="md-tabs__link">
          
  
    
  
  High level API

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Tutorial

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../dev/development_guidelines/" class="md-tabs__link">
          
  
    
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/plot_base/" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PUMA: Plotting UMami Api" class="md-nav__button md-logo" aria-label="PUMA: Plotting UMami Api" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PUMA: Plotting UMami Api
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/umami-hep/puma" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dummy_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dummy Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../histograms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Histograms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROC curves
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../int_eff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrated efficiency plot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../var_vs_eff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variable vs efficiency Plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fraction_scan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fraction Scan Plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pie_charts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pie charts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../line_plots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Line plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../confusion_matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Confusion Matrix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../precision_recall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precision Recall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../matrix_plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matrix Plot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hlapi/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    High level API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            High level API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hlapi/high_level_aux_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    High level API for aux task plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hlapi/n_track_origin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Number of Tracks per Jet per Origin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hlapi/yuma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YUMA (Yaml Plotting)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-everything-you-need" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Everything You Need
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorial-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tutorial Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-0-flavour-tagging-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0: Flavour Tagging Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 0: Flavour Tagging Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-01-generating-dummy-data" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.1: Generating Dummy Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-02-defining-working-points-likelihood-ratio" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.2: Defining Working Points - Likelihood Ratio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-03-performance-metrics-efficiency-and-rejection" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.3: Performance Metrics - Efficiency and Rejection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-1-histogram-plots" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1: Histogram Plots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 1: Histogram Plots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-11-loading-the-h5-file" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.1: Loading the h5 File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-12-plotting-the-p_texttp_textt-distribution-for-jets-of-different-flavours" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.2: Plotting the p_\text{T}p_\text{T} Distribution for Jets of Different Flavours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-13-plot-the-bb-jets-probability-output-of-two-different-taggers" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.3: Plot the bb-jets Probability Output of two Different Taggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-14-plot-a-track-variable-of-your-choice" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.4: Plot a Track Variable of Your Choice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-2-roc-plots" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2: ROC Plots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 2: ROC Plots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-21-calculate-the-rejections-as-a-function-of-the-bb-jets-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.1: Calculate the Rejections as a Function of the bb-jets Efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-22-plot-the-rejections-as-a-function-of-the-bb-jets-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.2: Plot the Rejections as a Function of the bb-jets Efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-23-add-the-cc-rejection-to-your-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.3: Add the cc-rejection to Your Plot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-3-p_texttp_textt-vs-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3: p_\text{T}p_\text{T} vs. Efficiency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 3: p_\text{T}p_\text{T} vs. Efficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-31-calculate-the-discriminant-values" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.1: Calculate the discriminant values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-32-create-a-p_texttp_textt-vs-bb-efficiency-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.2: Create a p_\text{T}p_\text{T} vs. bb-efficiency Plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-33-create-a-p_texttp_textt-vs-light-flavour-jets-rejection-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.3: Create a p_\text{T}p_\text{T} vs. light-flavour jets rejection plot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Bonus tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bonus tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-over-a-run-3-mc-sample-and-compare-the-pileup-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      Run over a Run-3 MC Sample and Compare the Pileup Distributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-the-flipped-taggers-to-the-regular-flavour-tagging-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Compare the "Flipped Taggers" to the Regular Flavour Tagging Algorithms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/development_guidelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Good coding practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/docs_development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docs development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/plot_base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plot Base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/histogram/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Histogram
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/roc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/int_eff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrated Efficiency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/var_vs_var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variable vs Variable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/fraction_scan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fraction Scan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pie_chart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pie Chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/matshow_plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matshow Plot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-everything-you-need" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Everything You Need
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorial-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tutorial Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-0-flavour-tagging-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0: Flavour Tagging Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 0: Flavour Tagging Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-01-generating-dummy-data" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.1: Generating Dummy Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-02-defining-working-points-likelihood-ratio" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.2: Defining Working Points - Likelihood Ratio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-03-performance-metrics-efficiency-and-rejection" class="md-nav__link">
    <span class="md-ellipsis">
      Task 0.3: Performance Metrics - Efficiency and Rejection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-1-histogram-plots" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1: Histogram Plots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 1: Histogram Plots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-11-loading-the-h5-file" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.1: Loading the h5 File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-12-plotting-the-p_texttp_textt-distribution-for-jets-of-different-flavours" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.2: Plotting the p_\text{T}p_\text{T} Distribution for Jets of Different Flavours
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-13-plot-the-bb-jets-probability-output-of-two-different-taggers" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.3: Plot the bb-jets Probability Output of two Different Taggers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-14-plot-a-track-variable-of-your-choice" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1.4: Plot a Track Variable of Your Choice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-2-roc-plots" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2: ROC Plots
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 2: ROC Plots">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-21-calculate-the-rejections-as-a-function-of-the-bb-jets-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.1: Calculate the Rejections as a Function of the bb-jets Efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-22-plot-the-rejections-as-a-function-of-the-bb-jets-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.2: Plot the Rejections as a Function of the bb-jets Efficiency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-23-add-the-cc-rejection-to-your-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2.3: Add the cc-rejection to Your Plot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-3-p_texttp_textt-vs-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3: p_\text{T}p_\text{T} vs. Efficiency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task 3: p_\text{T}p_\text{T} vs. Efficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-31-calculate-the-discriminant-values" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.1: Calculate the discriminant values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-32-create-a-p_texttp_textt-vs-bb-efficiency-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.2: Create a p_\text{T}p_\text{T} vs. bb-efficiency Plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-33-create-a-p_texttp_textt-vs-light-flavour-jets-rejection-plot" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3.3: Create a p_\text{T}p_\text{T} vs. light-flavour jets rejection plot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Bonus tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bonus tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-over-a-run-3-mc-sample-and-compare-the-pileup-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      Run over a Run-3 MC Sample and Compare the Pileup Distributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-the-flipped-taggers-to-the-regular-flavour-tagging-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Compare the "Flipped Taggers" to the Regular Flavour Tagging Algorithms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="puma-plotting-tutorial">Puma Plotting Tutorial<a class="headerlink" href="#puma-plotting-tutorial" title="Permanent link">#</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>In this tutorial you will learn how to use <code>puma</code>, the <em>Plotting UMami Api</em>. The idea behind <code>puma</code>
is to provide a plotting API that is easy to use but at the same time highly configurable. This
means that the user has full control over the plot while things like uncertainties, labels, ratio
panels can be added easily.</p>
<p>You can find the <code>puma</code> documentation <a href="https://umami-hep.github.io/puma/">here</a>.</p>
<p><code>puma</code> is based on <code>matplotlib</code> and helps you to produce most of the types of plots that are
 commonly used in flavour tagging like the ones shown below:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">ROC curves</th>
<th style="text-align: center;">Histogram plots</th>
<th style="text-align: center;">Variable vs efficiency</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><img src=https://github.com/umami-hep/puma/raw/examples-material/roc.png width=200></td>
<td style="text-align: center;"><img src=https://github.com/umami-hep/puma/raw/examples-material/histogram_discriminant.png width=220></td>
<td style="text-align: center;"><img src=https://github.com/umami-hep/puma/raw/examples-material/pt_light_rej.png width=220></td>
</tr>
</tbody>
</table>
<p>In this tutorial you will learn how to:</p>
<ol>
<li>A small introduction to the different metrics used in flavour tagging.</li>
<li>Plot histograms with <code>puma</code>, where you will produce plots of both jet- and track-variables.</li>
<li>Plot ROC curves of two taggers, with ratio panels that compare the curves.</li>
<li>Plot the efficiency/rejection of a tagger as a function of <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span>.</li>
<li>Plot the input variables of the files using Umami.</li>
</ol>
<p>The tutorial is meant to be followed in a self-guided manner. You will be prompted to do certain
tasks by telling you what the desired outcome will be, without telling you how to do it. Using the
documentation of <code>puma</code>, you can find out how to achieve your goal. In case you are stuck, you can
click on the "hint" toggle box to get a hint. If you tried for more than 10 min at a problem, feel
free to toggle also the solution with a worked example.</p>
<h2 id="setting-up-everything-you-need">Setting Up Everything You Need<a class="headerlink" href="#setting-up-everything-you-need" title="Permanent link">#</a></h2>
<p>For the tutorial, you will need <code>puma</code>. Probably the easiest way to get <code>puma</code> is via <code>PYPI</code>.
You can install it like any other python package using the following command:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>puma-hep
</code></pre></div>
<p>You can also use so-called containers for the tutorial or in general for <code>puma</code>. This is the
recommended way to run <code>puma</code> if you have different python versions and dependencies running on your
system. You can read more about this in the <a href="https://ftag.docs.cern.ch/software/container_usage/">FTAG Docs</a>.</p>
<p>For this tutorial, two <code>.h5</code> files were prepared, one <span class="arithmatex"><span class="MathJax_Preview">t\bar{t}</span><script type="math/tex">t\bar{t}</script></span> and one <span class="arithmatex"><span class="MathJax_Preview">Z'</span><script type="math/tex">Z'</script></span> file. You can download
them from the <code>eos</code> directly. The path to the directory where the files are stored is
<code>/eos/user/u/umamibot/tutorials/</code>. If you don't have access to <code>eos</code>, you can simply download
the files via the following two command:</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://umami-ci-provider.web.cern.ch/puma/ttbar.h5
wget<span class="w"> </span>https://umami-ci-provider.web.cern.ch/puma/zpext.h5
</code></pre></div>
<h2 id="tutorial-tasks">Tutorial Tasks<a class="headerlink" href="#tutorial-tasks" title="Permanent link">#</a></h2>
<p>The tasks are divided in several su<span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tasks. You don't have to do all of them in case you are more
interested in the other tasks. However, the su<span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tasks depend on each other, so you should finish a
subtask before proceeding to the next one (also the solutions assume that you already have the
previous subtasks completed).</p>
<h3 id="task-0-flavour-tagging-metrics">Task 0: Flavour Tagging Metrics<a class="headerlink" href="#task-0-flavour-tagging-metrics" title="Permanent link">#</a></h3>
<p>To get started with the plotting, we will first have a quick look into different metrics
used in flavour tagging to evaluate the performance.</p>
<h4 id="task-01-generating-dummy-data">Task 0.1: Generating Dummy Data<a class="headerlink" href="#task-01-generating-dummy-data" title="Permanent link">#</a></h4>
<p>The typical output of our ML-based taggers, like DIPS or DL1d, are 3 scores indicating the
probabilities of being a light-flavour jet, a <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet and a <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet. For example the scores
<code>[0.1, 0.3, 0.6]</code> would indicate that we have most probably a <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet while <code>[0.7, 0.2, 0.1]</code> would
indicate a light-flavour jet.</p>
<p>Even though we always have MC simulation, it is sometimes useful to have dummy data, for instance if
we want to test certain plotting features etc. (and to understand the actual underlying
distributions).</p>
<p>Now, it is up to you. <strong>Generate a dummy multi-class output of a neural network.</strong></p>
<details class="info">
<summary>Hint: Where can I find such a function?</summary>
<p>You can have a look at the <a href="https://umami-hep.github.io/puma/main/index.html">puma documentation</a>
and search in the API reference.</p>
</details>
<details class="info">
<summary>Hint: Which exact function?</summary>
<p>The <code>puma.utils</code> module contains the desired functions</p>
</details>
<details class="warning">
<summary>Solution</summary>
<p>Dummy data are explained <a href="https://umami-hep.github.io/puma/examples/dummy_data/">here</a></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">puma.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_dummy_multiclass_scores</span>

<span class="c1"># Generating 10_000 jets</span>
<span class="n">dummy_jets</span><span class="p">,</span> <span class="n">dummy_labels</span> <span class="o">=</span> <span class="n">get_dummy_multiclass_scores</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dummy_jets</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dummy_labels</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-02-defining-working-points-likelihood-ratio">Task 0.2: Defining Working Points - Likelihood Ratio<a class="headerlink" href="#task-02-defining-working-points-likelihood-ratio" title="Permanent link">#</a></h4>
<p>Since we are not (yet) able to calibrate the entire spectrum of the different multi-class outputs,
we need to define so-called working points (or operating points). In the case of ATLAS, we have
four/five different <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tagging working points (WPs) which are defined covering various needs of the
physics analyses. The efficiency of a specific flavour <span class="arithmatex"><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> (<span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>, <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span> or light) is defined as</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\varepsilon^j = \frac{N_\text{pass}^j(\mathcal{D}&gt;T_f)}{N_\text{total}^j},
</div>
<script type="math/tex; mode=display">
\varepsilon^j = \frac{N_\text{pass}^j(\mathcal{D}>T_f)}{N_\text{total}^j},
</script>
</div>
<p>where <span class="arithmatex"><span class="MathJax_Preview">N_\text{pass}^j(\mathcal{D}&gt;T_f)</span><script type="math/tex">N_\text{pass}^j(\mathcal{D}>T_f)</script></span> are the number of jets of flavour <span class="arithmatex"><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> passing the cut <span class="arithmatex"><span class="MathJax_Preview">T_f</span><script type="math/tex">T_f</script></span>
on the tagger discriminant <span class="arithmatex"><span class="MathJax_Preview">\mathcal{D}</span><script type="math/tex">\mathcal{D}</script></span> and <span class="arithmatex"><span class="MathJax_Preview">N_\text{total}^j</span><script type="math/tex">N_\text{total}^j</script></span> are all jets of flavour <span class="arithmatex"><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> before
the cut.</p>
<p>The final output score is calculated from the multi-class output and results for the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tagging
discriminant into the log-likelihood</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathcal{D}_\text{b}(f_c) = \log \left(  \frac{p_b}{f_c\cdot p_c+(1-f_c)\cdot p_u} \right),
</div>
<script type="math/tex; mode=display">
\mathcal{D}_\text{b}(f_c) = \log \left(  \frac{p_b}{f_c\cdot p_c+(1-f_c)\cdot p_u} \right),
</script>
</div>
<p>with <span class="arithmatex"><span class="MathJax_Preview">p_b</span><script type="math/tex">p_b</script></span>, <span class="arithmatex"><span class="MathJax_Preview">p_c</span><script type="math/tex">p_c</script></span> and <span class="arithmatex"><span class="MathJax_Preview">p_u</span><script type="math/tex">p_u</script></span> being the probabilities for the jet to be a <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet, <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet or
light-flavour jet (often refered to as <span class="arithmatex"><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span>-jets), respectively. The <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet fraction value <span class="arithmatex"><span class="MathJax_Preview">f_c</span><script type="math/tex">f_c</script></span>
allows to tune how much emphasis is given to the <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet or to the light-flavour performance. While
the <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet rejection increases as a function of <span class="arithmatex"><span class="MathJax_Preview">f_c</span><script type="math/tex">f_c</script></span>, the light-flavour jet rejection decreases.
This parameter has to be tuned separately for each tagger and depends on the needs of the physics
analyses.</p>
<p>The advantage of the multi-class output is that this tuning is possible after the training and the
<span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet fraction value in the training sample does not have to be adapted. Another advantage of the
multi-class output is that one can by changing the log-likelihood to</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathcal{D}_\text{c}(f_b) = \log \left(  \frac{p_c}{f_b\cdot p_b+(1-f_b)\cdot p_u} \right),
</div>
<script type="math/tex; mode=display">
\mathcal{D}_\text{c}(f_b) = \log \left(  \frac{p_c}{f_b\cdot p_b+(1-f_b)\cdot p_u} \right),
</script>
</div>
<p>perform <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-tagging without the need of retraining the tagger. Here <span class="arithmatex"><span class="MathJax_Preview">f_b</span><script type="math/tex">f_b</script></span> is now the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet
fraction value.</p>
<p><strong>Define a function which calculates the log-likelihood, when giving it the 3 scores and the <span class="arithmatex"><span class="MathJax_Preview">f_c</span><script type="math/tex">f_c</script></span> value as input.</strong></p>
<details class="info">
<summary>Hint 1</summary>
<p>You can either use a python function <code>def</code> or a <code>lambda</code> function</p>
</details>
<details class="info">
<summary>Hint 2</summary>
<p>You can find the solution in the
<a href="https://github.com/umami-hep/atlas-ftag-tools/tree/main">atlas-ftag-tools</a> package.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<p>This implementation here is hardcoded to explain how it works. In general, it is recommended
to use the <code>get_discriminant</code> function from the 
<a href="https://github.com/umami-hep/atlas-ftag-tools/tree/main">atlas-ftag-tools</a> package</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="k">def</span><span class="w"> </span><span class="nf">disc_fct</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">f_c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.018</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tagger discriminant</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : numpy.ndarray</span>
<span class="sd">        array with with shape (, 3)</span>
<span class="sd">    f_c : float, optional</span>
<span class="sd">        f_c value in the discriminant (weight for $c$-jets rejection)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        Array with the discriminant values inside.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># you can adapt this for your needs</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_c</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f_c</span><span class="p">)</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


<span class="c1"># you can also use a lambda function</span>
<span class="c1"># fc = 0.018</span>
<span class="c1"># lambda a: np.log(a[2] / (fc * a[1] + (1 - fc) * a[0]))</span>
</code></pre></div>
</details>
<p><strong>Using the <code>dummy data</code> from task 0.1, calculate the log-likelihood with <span class="arithmatex"><span class="MathJax_Preview">f_c=0.018</span><script type="math/tex">f_c=0.018</script></span> and
retrieve the working point cut value for 70% <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet efficiency.</strong></p>
<details class="info">
<summary>Hint: Where to get the Labels from?</summary>
<p>The <code>labels</code> from task 0.1 have the same values as the <code>HadronConeExclTruthLabelID</code>
described in the <a href="https://ftag.docs.cern.ch/algorithms/labelling/jet_labels/#delta-r-matching-default-scheme-in-ftag">FTAG algo docs</a>.</p>
</details>
<details class="info">
<summary>Hint: Which Function to Use?</summary>
<p>You can have a look at the <code>percentile</code> function from <code>numpy</code>.
Be aware from which site we need to integrate!
And the <code>apply_along_axis</code> function to evaluate an entire array.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">bjets</span> <span class="o">=</span> <span class="n">dummy_labels</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">dummy_jets_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">dummy_jets</span><span class="p">[</span><span class="s1">&#39;ujets&#39;</span><span class="p">],</span> <span class="n">dummy_jets</span><span class="p">[</span><span class="s1">&#39;cjets&#39;</span><span class="p">],</span> <span class="n">dummy_jets</span><span class="p">[</span><span class="s1">&#39;bjets&#39;</span><span class="p">]))</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">disc_fct</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">dummy_jets_2d</span><span class="p">)</span>
<span class="n">target_eff</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">cutvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">bjets</span><span class="p">],</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">target_eff</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cut value for 70% $b$-jet efficiency:&quot;</span><span class="p">,</span> <span class="n">cutvalue</span><span class="p">)</span>
</code></pre></div>
<p>The current way to implement this is using the <a href="https://github.com/umami-hep/atlas-ftag-tools/blob/main/ftag/utils/metrics.py">atlas-ftag-tools metrics functions</a></p>
</details>
<h4 id="task-03-performance-metrics-efficiency-and-rejection">Task 0.3: Performance Metrics - Efficiency and Rejection<a class="headerlink" href="#task-03-performance-metrics-efficiency-and-rejection" title="Permanent link">#</a></h4>
<p>To quantify the performance of a tagger at a given working point, the background rejection is a good
measure. The rejection is simply the inverse of the efficiency <span class="arithmatex"><span class="MathJax_Preview">\frac{1}{\varepsilon^j}</span><script type="math/tex">\frac{1}{\varepsilon^j}</script></span>.</p>
<p><strong>Calculate the light-flavour jet and <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jet rejection for the 70% working point from task 0.2.</strong></p>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="n">ljets</span> <span class="o">=</span> <span class="n">dummy_labels</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">cjets</span> <span class="o">=</span> <span class="n">dummy_labels</span> <span class="o">==</span> <span class="mi">4</span>

<span class="n">ljets_eff</span> <span class="o">=</span> <span class="p">((</span><span class="n">scores</span> <span class="o">&gt;</span> <span class="n">cutvalue</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ljets</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">ljets</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;light-flavour jets efficiency:&quot;</span><span class="p">,</span> <span class="n">ljets_eff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;light-flavour jets rejection:&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">ljets_eff</span><span class="p">)</span>

<span class="n">cjets_eff</span> <span class="o">=</span> <span class="p">((</span><span class="n">scores</span> <span class="o">&gt;</span> <span class="n">cutvalue</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">cjets</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">cjets</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;$c$-flavour jets efficiency:&quot;</span><span class="p">,</span> <span class="n">cjets_eff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;$c$-flavour jets rejection:&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">cjets_eff</span><span class="p">)</span>
</code></pre></div>
<p>Alternatively, all this functionality is also provided by the <code>atlas-ftag-tools</code> package.
In that case this would simplify to
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ftag.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_rejection</span>
<span class="n">ljets</span> <span class="o">=</span> <span class="n">dummy_labels</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">cjets</span> <span class="o">=</span> <span class="n">dummy_labels</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">rej</span> <span class="o">=</span> <span class="n">calculate_rejection</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">bjets</span><span class="p">],</span> <span class="n">scores</span><span class="p">[</span><span class="n">ljets</span><span class="p">],</span> <span class="n">target_eff</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;light-flavour jets rejection:&quot;</span><span class="p">,</span> <span class="n">rej</span><span class="p">)</span>
</code></pre></div></p>
</details>
<p>Starting from these metrics, we can plot for instance:</p>
<ul>
<li><strong>ROC curves</strong>: which show the background rejection as function of the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jet efficency</li>
<li><strong>Efficiency vs <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span></strong>: where one fixes a working point and calculates the background rejection in bins of <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span></li>
</ul>
<h3 id="task-1-histogram-plots">Task 1: Histogram Plots<a class="headerlink" href="#task-1-histogram-plots" title="Permanent link">#</a></h3>
<h4 id="task-11-loading-the-h5-file">Task 1.1: Loading the h5 File<a class="headerlink" href="#task-11-loading-the-h5-file" title="Permanent link">#</a></h4>
<p>Before starting with the different plotting exercises, you have to load the h5 file that was
prepared for this tutorial. The expected outcome of this is that you have access to the jet
variables as well as to the track variables. You can put the jet variables in a <code>pandas.DataFrame</code>
in case you feel more comfortable with that, but this will not be possible for the tracks, since the
<code>tracks_loose</code> dataset in the h5 file has an extra dimension for the tracks (for each jet we store
the information of up to 40 tracks).</p>
<ol>
<li>Write a little python script that loads the jet and track variables.</li>
<li>Have a look at how large the dataset is, and what shape the loaded arrays have.</li>
</ol>
<p>For the following tasks you can re-use the code that loads the h5 file or just extend your python
script from this task.</p>
<details class="info">
<summary>Hint: How can I Load a h5 File with Python?</summary>
<p>You can find the documentation of <code>h5py</code> <a href="https://docs.h5py.org/en/stable/quick.html">here</a>.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>

<span class="c1"># Use directly the eos path or use the path to your downloaded files</span>
<span class="n">ttbar_filepath</span> <span class="o">=</span> <span class="s2">&quot;/eos/user/u/umamibot/tutorials/ttbar.h5&quot;</span>

<span class="c1"># load the &quot;jets&quot; and &quot;tracks_loose&quot; dataset from the h5 file</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">ttbar_filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5file</span><span class="p">:</span>
    <span class="n">jets</span> <span class="o">=</span> <span class="n">h5file</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">][:]</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="n">h5file</span><span class="p">[</span><span class="s2">&quot;tracks_loose&quot;</span><span class="p">][:]</span>

<span class="c1"># print the shape and the field names of the datasets</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jets</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tracks</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tracks</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-12-plotting-the-p_texttp_textt-distribution-for-jets-of-different-flavours">Task 1.2: Plotting the <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span> Distribution for Jets of Different Flavours<a class="headerlink" href="#task-12-plotting-the-p_texttp_textt-distribution-for-jets-of-different-flavours" title="Permanent link">#</a></h4>
<p>As a next step, you will produce a histogram plot that shows the <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span> distribution of light-flavour
jets, <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets and <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets.</p>
<details class="info">
<summary>Hint: How do I Create a Histogram Plot with <code>puma</code>?</summary>
<p>You can find the examples of histogram plots
<a href="https://umami-hep.github.io/puma/examples/histograms/">here</a> and the
documentation for histogram plots with <code>puma</code>
<a href="https://umami-hep.github.io/puma/api/histogram/">here</a>.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">puma</span><span class="w"> </span><span class="kn">import</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">HistogramPlot</span>

<span class="c1"># Use directly the eos path or use the path to your downloaded files</span>
<span class="n">ttbar_filepath</span> <span class="o">=</span> <span class="s2">&quot;/eos/user/u/umamibot/tutorials/ttbar.h5&quot;</span>

<span class="c1"># load the jets dataset from the h5 file</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">ttbar_filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5file</span><span class="p">:</span>
    <span class="n">jets</span> <span class="o">=</span> <span class="n">h5file</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">][:]</span>

<span class="c1"># defining boolean arrays to select the different flavour classes</span>
<span class="n">is_light</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">is_c</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">is_b</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span>

<span class="c1"># initialise the plot</span>
<span class="n">pt_plot</span> <span class="o">=</span> <span class="n">HistogramPlot</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p_\text</span><span class="si">{T}</span><span class="s2">$ [GeV]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Normalised number of jets&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># add the histograms (Note that the Histogram objects need to have the same bins!)</span>
<span class="n">pt_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Histogram</span><span class="p">(</span><span class="n">jets</span><span class="p">[</span><span class="n">is_light</span><span class="p">][</span><span class="s2">&quot;pt_btagJes&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
<span class="n">pt_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Histogram</span><span class="p">(</span><span class="n">jets</span><span class="p">[</span><span class="n">is_c</span><span class="p">][</span><span class="s2">&quot;pt_btagJes&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
<span class="n">pt_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Histogram</span><span class="p">(</span><span class="n">jets</span><span class="p">[</span><span class="n">is_b</span><span class="p">][</span><span class="s2">&quot;pt_btagJes&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>

<span class="n">pt_plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">pt_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_histogram_pT.png&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-13-plot-the-bb-jets-probability-output-of-two-different-taggers">Task 1.3: Plot the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets Probability Output of two Different Taggers<a class="headerlink" href="#task-13-plot-the-bb-jets-probability-output-of-two-different-taggers" title="Permanent link">#</a></h4>
<p>In this task you will plot the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets probability of two different taggers - RNNIP and DIPS.</p>
<ol>
<li>Create the histogram plot (similar to the one from the previous task) and the different
    histograms. If you plot this for light-flavour jets, <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jets and <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets, you should have 6
    histograms.</li>
<li>Make sure that you use a different linestyle for the histgrams of you second tagger.</li>
<li>Add a ratio panel to the plot</li>
<li>Make your plot look pretty. Have a look at the arguments that are supported by
    <a href="https://umami-hep.github.io/puma/main/autoapi/puma/plot_base/index.html#puma.plot_base.PlotObject"><code>puma.PlotObject</code></a>.</li>
</ol>
<details class="info">
<summary>Hint 1: Histogram and HistogramPlot Objects</summary>
<p>After you defined your HistogramPlot object, you can start adding lines to it.
This lines are the Histogram objects you need to define.</p>
</details>
<details class="info">
<summary>Hint 2: Linestyle</summary>
<p>The <code>linestyle</code> can be set when the different <code>Histogram</code> lines are initalised.</p>
</details>
<details class="info">
<summary>Hint 3: Ratio Panel</summary>
<p>The ratio for the ratio panel is calculated in this case between the same flavours. But you
need to tell the plot which of the Histogram objects is the reference. Try to look up the
<code>reference</code> option in the <code>add()</code> function.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="n">tagger_output_plot</span> <span class="o">=</span> <span class="n">HistogramPlot</span><span class="p">(</span>
    <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$b$-jets probability&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Normalised number of jets&quot;</span><span class="p">,</span>
    <span class="c1"># optional:</span>
    <span class="c1"># figsize=(6, 4.5),</span>
    <span class="c1"># leg_ncol=2,</span>
    <span class="c1"># atlas_second_tag=&quot;$t\\bar{t}$ R22 sample&quot;,</span>
    <span class="c1"># logy=True,</span>
<span class="p">)</span>

<span class="c1"># add the histograms</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_light</span><span class="p">][</span><span class="s2">&quot;rnnip_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_c</span><span class="p">][</span><span class="s2">&quot;rnnip_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_b</span><span class="p">][</span><span class="s2">&quot;rnnip_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># add the histograms</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_light</span><span class="p">][</span><span class="s2">&quot;dipsLoose20220314v2_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_c</span><span class="p">][</span><span class="s2">&quot;dipsLoose20220314v2_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets</span><span class="p">[</span><span class="n">is_b</span><span class="p">][</span><span class="s2">&quot;dipsLoose20220314v2_pb&quot;</span><span class="p">],</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">tagger_output_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_histogram_tagger_pb_comparison.png&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-14-plot-a-track-variable-of-your-choice">Task 1.4: Plot a Track Variable of Your Choice<a class="headerlink" href="#task-14-plot-a-track-variable-of-your-choice" title="Permanent link">#</a></h4>
<p>In this task you are asked to make a histogram plot of a <em>track variable</em>. This is slightly more
tricky, since the array that you load from the h5 file has a different shape compared to the array
storing the jet information. In addition to that, many entries might be filled with <code>nan</code> values,
which is challenging here and there.</p>
<ol>
<li>Choose a track variable that you want to plot.</li>
<li>Create a histogram plot (maybe again for multiple flavours, but that is up to you).</li>
</ol>
<details class="info">
<summary>Hint 1: NaN-Values in Binning</summary>
<p>If you encounter an issue with NaN values in the binning, you need to set the
<code>bins_range</code> correctly, because with NaN values it cannot be calculated automatically.</p>
</details>
<details class="info">
<summary>Hint 2: Difference in Shape</summary>
<p>Due to the dimensionality of tracks, you need to get rid of one of the dimensions.
Try the <code>.flatten()</code> option of <code>numpy.ndarray</code>'s</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">ttbar_filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5file</span><span class="p">:</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="n">h5file</span><span class="p">[</span><span class="s2">&quot;/tracks_loose&quot;</span><span class="p">][:,</span> <span class="p">:]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tracks</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">d0_plot</span> <span class="o">=</span> <span class="n">HistogramPlot</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$d_0$ significance&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Normalised number of tracks&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">d0_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">tracks</span><span class="p">[</span><span class="s2">&quot;IP3D_signed_d0_significance&quot;</span><span class="p">][</span><span class="n">is_light</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">d0_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">tracks</span><span class="p">[</span><span class="s2">&quot;IP3D_signed_d0_significance&quot;</span><span class="p">][</span><span class="n">is_c</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">d0_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">tracks</span><span class="p">[</span><span class="s2">&quot;IP3D_signed_d0_significance&quot;</span><span class="p">][</span><span class="n">is_b</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">d0_plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">d0_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_histogram_track_variable.png&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="task-2-roc-plots">Task 2: ROC Plots<a class="headerlink" href="#task-2-roc-plots" title="Permanent link">#</a></h3>
<p>In this task, you will plot a ROC comparison for the two taggers <em>RNNIP</em> and <em>DIPS</em>.</p>
<h4 id="task-21-calculate-the-rejections-as-a-function-of-the-bb-jets-efficiency">Task 2.1: Calculate the Rejections as a Function of the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets Efficiency<a class="headerlink" href="#task-21-calculate-the-rejections-as-a-function-of-the-bb-jets-efficiency" title="Permanent link">#</a></h4>
<p>Before you can actually plot the ROC curves, you have to calculate the light-flavour and <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jets
rejection for a range of <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets efficiencies.</p>
<ol>
<li>Define a function that calculates the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets discriminant from the tagger output.</li>
<li>Calculate the light-flavour jets rejection as a function of the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets efficiency.</li>
</ol>
<details class="info">
<summary>Hint: Look at Examples</summary>
<p>Multiple examples (also for ROCs) are provided in the <code>puma</code> examples.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">puma</span><span class="w"> </span><span class="kn">import</span> <span class="n">Roc</span><span class="p">,</span> <span class="n">RocPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_rejection</span><span class="p">,</span> <span class="n">get_discriminant</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flavours</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.hdf5</span><span class="w"> </span><span class="kn">import</span> <span class="n">H5Reader</span>

<span class="n">ttbar_filepath</span> <span class="o">=</span> <span class="s2">&quot;/eos/user/u/umamibot/tutorials/ttbar.h5&quot;</span>

<span class="c1"># load the jets dataset from the h5 file</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">H5Reader</span><span class="p">(</span><span class="n">ttbar_filepath</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">jets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">]</span>

<span class="c1"># Calculate the discriminant for both taggers</span>
<span class="n">discs_dips</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;dipsLoose20220314v2&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.018</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.982</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">discs_rnnip</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;rnnip&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.018</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.982</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># defining target efficiency</span>
<span class="n">sig_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.49</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># defining boolean arrays to select the different flavour classes</span>
<span class="n">is_light</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">is_c</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">is_b</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span>

<span class="n">n_jets_light</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">is_light</span><span class="p">)</span>
<span class="n">n_jets_c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">is_c</span><span class="p">)</span>

<span class="n">rnnip_ujets_rej</span> <span class="o">=</span> <span class="n">calculate_rejection</span><span class="p">(</span><span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span> <span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span> <span class="n">sig_eff</span><span class="p">)</span>
<span class="n">dips_ujets_rej</span> <span class="o">=</span> <span class="n">calculate_rejection</span><span class="p">(</span><span class="n">discs_dips</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span> <span class="n">discs_dips</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span> <span class="n">sig_eff</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-22-plot-the-rejections-as-a-function-of-the-bb-jets-efficiency">Task 2.2: Plot the Rejections as a Function of the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets Efficiency<a class="headerlink" href="#task-22-plot-the-rejections-as-a-function-of-the-bb-jets-efficiency" title="Permanent link">#</a></h4>
<ol>
<li>Plot the light-flavour jets rejection as a function of the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets efficiency. Use
    <code>n_ratio_panels=1</code> to also get the ratio of the two rejection curves.</li>
</ol>
<details class="info">
<summary>Hint 1: How do I Initialise a ROC Curve Plot?</summary>
<p>Plotting ROC curves with <code>puma</code> is similar to plotting histograms. The main difference
is that you are using the <code>puma.RocPlot</code> and <code>puma.Roc</code> classes. Search the
[puma docs] for "roc" to have a look at an example and the API reference.</p>
</details>
<details class="info">
<summary>Hint 2: I Initialised the Plot and Added the ROC Curves - Is there anything else to do?</summary>
<p>For ROC curves you also have to define the class which is drawn in the ratio panel.
The method you need to use here is <code>RocPlot.set_ratio_class()</code>.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<p>Add this part under the calculation of the rejection values.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Define the ROC class instances</span>
<span class="n">rnnip_ujets_roc</span> <span class="o">=</span> <span class="n">Roc</span><span class="p">(</span>
    <span class="n">sig_eff</span><span class="o">=</span><span class="n">sig_eff</span><span class="p">,</span>
    <span class="n">bkg_rej</span><span class="o">=</span><span class="n">rnnip_ujets_rej</span><span class="p">,</span>
    <span class="n">n_test</span><span class="o">=</span><span class="n">n_jets_light</span><span class="p">,</span>
    <span class="n">rej_class</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
    <span class="n">signal_class</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dips_ujets_roc</span> <span class="o">=</span> <span class="n">Roc</span><span class="p">(</span>
    <span class="n">sig_eff</span><span class="o">=</span><span class="n">sig_eff</span><span class="p">,</span>
    <span class="n">bkg_rej</span><span class="o">=</span><span class="n">dips_ujets_rej</span><span class="p">,</span>
    <span class="n">n_test</span><span class="o">=</span><span class="n">n_jets_light</span><span class="p">,</span>
    <span class="n">rej_class</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
    <span class="n">signal_class</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DIPS r22&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Set up a plot</span>
<span class="n">plot_roc</span> <span class="o">=</span> <span class="n">RocPlot</span><span class="p">(</span>
    <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Background rejection&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$b$-jet efficiency&quot;</span><span class="p">,</span>
    <span class="n">atlas_second_tag</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sqrt</span><span class="si">{s}</span><span class="s2">=13$ TeV, dummy jets </span><span class="se">\n</span><span class="s2">dummy sample, $f_</span><span class="si">{c}</span><span class="s2">=0.018$&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">y_scale</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add the ROC objects to the plot</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">add_roc</span><span class="p">(</span><span class="n">roc_curve</span><span class="o">=</span><span class="n">rnnip_ujets_roc</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">add_roc</span><span class="p">(</span><span class="n">roc_curve</span><span class="o">=</span><span class="n">dips_ujets_roc</span><span class="p">)</span>

<span class="c1"># Set the ratio class for the ratio panels</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">set_ratio_class</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ujets&quot;</span><span class="p">)</span>

<span class="c1"># Draw and save the plot</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_roc.png&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-23-add-the-cc-rejection-to-your-plot">Task 2.3: Add the <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-rejection to Your Plot<a class="headerlink" href="#task-23-add-the-cc-rejection-to-your-plot" title="Permanent link">#</a></h4>
<ol>
<li>Repeat the calculation of the rejection for <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jets</li>
<li>Add the corresponding ROC curves to the plot. Don't forget to increase <code>n_ratio_panels</code>
    of your <code>puma.RocPlot</code>.</li>
</ol>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Add this to the calculation part of the script (place it below or above the other calculate_rejection)</span>
<span class="n">rnnip_cjets_rej</span> <span class="o">=</span> <span class="n">calculate_rejection</span><span class="p">(</span><span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span> <span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_c</span><span class="p">],</span> <span class="n">sig_eff</span><span class="p">)</span>
<span class="n">dips_cjets_rej</span> <span class="o">=</span> <span class="n">calculate_rejection</span><span class="p">(</span><span class="n">discs_dips</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span> <span class="n">discs_dips</span><span class="p">[</span><span class="n">is_c</span><span class="p">],</span> <span class="n">sig_eff</span><span class="p">)</span>

<span class="c1"># Add this below the definition of the other ROC objects</span>
<span class="n">rnnip_cjets_roc</span> <span class="o">=</span> <span class="n">Roc</span><span class="p">(</span>
    <span class="n">sig_eff</span><span class="o">=</span><span class="n">sig_eff</span><span class="p">,</span>
    <span class="n">bkg_rej</span><span class="o">=</span><span class="n">rnnip_cjets_rej</span><span class="p">,</span>
    <span class="n">n_test</span><span class="o">=</span><span class="n">n_jets_c</span><span class="p">,</span>
    <span class="n">rej_class</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
    <span class="n">signal_class</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dips_cjets_roc</span> <span class="o">=</span> <span class="n">Roc</span><span class="p">(</span>
    <span class="n">sig_eff</span><span class="o">=</span><span class="n">sig_eff</span><span class="p">,</span>
    <span class="n">bkg_rej</span><span class="o">=</span><span class="n">dips_cjets_rej</span><span class="p">,</span>
    <span class="n">n_test</span><span class="o">=</span><span class="n">n_jets_c</span><span class="p">,</span>
    <span class="n">rej_class</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
    <span class="n">signal_class</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DIPS r22&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Set the n_ratio_panels in the RocPlot to 2!</span>

<span class="c1"># Add this below the add_roc() from the other light jets</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">add_roc</span><span class="p">(</span><span class="n">roc_curve</span><span class="o">=</span><span class="n">rnnip_cjets_roc</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">add_roc</span><span class="p">(</span><span class="n">roc_curve</span><span class="o">=</span><span class="n">dips_cjets_roc</span><span class="p">)</span>

<span class="c1"># Add this to the below the other set_ratio_class</span>
<span class="n">plot_roc</span><span class="o">.</span><span class="n">set_ratio_class</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;cjets&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="task-3-p_texttp_textt-vs-efficiency">Task 3: <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span> vs. Efficiency<a class="headerlink" href="#task-3-p_texttp_textt-vs-efficiency" title="Permanent link">#</a></h3>
<p>In this task, you will plot both the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets efficiency and the light-flavour jets rejection for
specific bins of <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span>.</p>
<h4 id="task-31-calculate-the-discriminant-values">Task 3.1: Calculate the discriminant values<a class="headerlink" href="#task-31-calculate-the-discriminant-values" title="Permanent link">#</a></h4>
<p>Just like you did in Task 2.1, calculate the discriminant scores for <em>RNNIP</em> and <em>DIPS</em>. You can
reuse the code from task 2.1. If you are putting everything in one python script you can just reuse
the values that are already calculated.</p>
<h4 id="task-32-create-a-p_texttp_textt-vs-bb-efficiency-plot">Task 3.2: Create a <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span> vs. <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-efficiency Plot<a class="headerlink" href="#task-32-create-a-p_texttp_textt-vs-bb-efficiency-plot" title="Permanent link">#</a></h4>
<p>For a fixed inclusive <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-efficiency, you plot the <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-efficiency for different bins of <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span>.</p>
<details class="info">
<summary>Hint 1: I'm not sure which type of Plot I need</summary>
<p>The plot type you are looking for is <code>VarVsEff</code> and <code>VarVsEffPlot</code>.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">puma</span><span class="w"> </span><span class="kn">import</span> <span class="n">VarVsEff</span><span class="p">,</span> <span class="n">VarVsEffPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_discriminant</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flavours</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.hdf5</span><span class="w"> </span><span class="kn">import</span> <span class="n">H5Reader</span>

<span class="n">ttbar_filepath</span> <span class="o">=</span> <span class="s2">&quot;/eos/user/u/umamibot/tutorials/ttbar.h5&quot;</span>

<span class="c1"># load the jets dataset from the h5 file</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">H5Reader</span><span class="p">(</span><span class="n">ttbar_filepath</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">jets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">]</span>

<span class="c1"># Calculate the discriminant for both taggers</span>
<span class="n">discs_dips</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;dipsLoose20220314v2&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.018</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.982</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">discs_rnnip</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;rnnip&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.018</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.982</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># Getting jet pt in GeV (in the files, they are stored in MeV)</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;pt&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span>

<span class="c1"># defining target efficiency</span>
<span class="n">sig_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.49</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># defining boolean arrays to select the different flavour classes</span>
<span class="n">is_light</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">is_c</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">is_b</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span>

<span class="c1"># here the plotting starts</span>

<span class="c1"># define the curves</span>
<span class="n">rnnip_light</span> <span class="o">=</span> <span class="n">VarVsEff</span><span class="p">(</span>
    <span class="n">x_var_sig</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span>
    <span class="n">disc_sig</span><span class="o">=</span><span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span>
    <span class="n">x_var_bkg</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span>
    <span class="n">disc_bkg</span><span class="o">=</span><span class="n">discs_rnnip</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>
    <span class="n">working_point</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">disc_cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">flat_per_bin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dips_light</span> <span class="o">=</span> <span class="n">VarVsEff</span><span class="p">(</span>
    <span class="n">x_var_sig</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span>
    <span class="n">disc_sig</span><span class="o">=</span><span class="n">discs_dips</span><span class="p">[</span><span class="n">is_b</span><span class="p">],</span>
    <span class="n">x_var_bkg</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span>
    <span class="n">disc_bkg</span><span class="o">=</span><span class="n">discs_dips</span><span class="p">[</span><span class="n">is_light</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>
    <span class="n">working_point</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">disc_cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">flat_per_bin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;DIPS&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># You can choose between different modes: &quot;sig_eff&quot;, &quot;bkg_eff&quot;, &quot;sig_rej&quot;, &quot;bkg_rej&quot;</span>
<span class="n">plot_sig_eff</span> <span class="o">=</span> <span class="n">VarVsEffPlot</span><span class="p">(</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;sig_eff&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$b$-jets efficiency&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p_</span><span class="si">{T}</span><span class="s2">$ [GeV]&quot;</span><span class="p">,</span>
    <span class="n">logy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">atlas_second_tag</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sqrt</span><span class="si">{s}</span><span class="s2">=13$ TeV, PFlow jets, </span><span class="se">\n</span><span class="s2">$t</span><span class="se">\\</span><span class="s2">bar</span><span class="si">{t}</span><span class="s2">$ sample, $f_</span><span class="si">{c}</span><span class="s2">=0.018$&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
    <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_light</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dips_light</span><span class="p">)</span>

<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">atlas_second_tag</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;Inclusive $\epsilon_b=70\%$&quot;</span>

<span class="c1"># If you want to inverse the discriminant cut you can enable it via</span>
<span class="c1"># plot_sig_eff.set_inverse_cut()</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="c1"># Drawing a hline indicating inclusive efficiency</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">draw_hline</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_pt_b_eff.png&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="task-33-create-a-p_texttp_textt-vs-light-flavour-jets-rejection-plot">Task 3.3: Create a <span class="arithmatex"><span class="MathJax_Preview">p_\text{T}</span><script type="math/tex">p_\text{T}</script></span> vs. light-flavour jets rejection plot<a class="headerlink" href="#task-33-create-a-p_texttp_textt-vs-light-flavour-jets-rejection-plot" title="Permanent link">#</a></h4>
<details class="warning">
<summary>Solution</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># reuse the VarVsEff objects that were defined for the previous exercise</span>
<span class="n">plot_bkg_rej</span> <span class="o">=</span> <span class="n">VarVsEffPlot</span><span class="p">(</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bkg_rej&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Light-flavour jets rejection&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p_</span><span class="si">{T}</span><span class="s2">$ [GeV]&quot;</span><span class="p">,</span>
    <span class="n">logy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">atlas_second_tag</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">sqrt</span><span class="si">{s}</span><span class="s2">=13$ TeV, PFlow jets </span><span class="se">\n</span><span class="s2">$t</span><span class="se">\\</span><span class="s2">bar</span><span class="si">{t}</span><span class="s2">$ sample, $f_</span><span class="si">{c}</span><span class="s2">=0.018$&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
    <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_sig_eff</span><span class="o">.</span><span class="n">atlas_second_tag</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;Inclusive $\epsilon_b=70\%$&quot;</span>
<span class="n">plot_bkg_rej</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_light</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_bkg_rej</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dips_light</span><span class="p">)</span>

<span class="n">plot_bkg_rej</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plot_bkg_rej</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;tutorial_pt_light_rej.png&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="bonus-tasks">Bonus tasks<a class="headerlink" href="#bonus-tasks" title="Permanent link">#</a></h2>
<h3 id="run-over-a-run-3-mc-sample-and-compare-the-pileup-distributions">Run over a Run-3 MC Sample and Compare the Pileup Distributions<a class="headerlink" href="#run-over-a-run-3-mc-sample-and-compare-the-pileup-distributions" title="Permanent link">#</a></h3>
<p>This task will extend over the simple histogram plotting you already encountered in Task 1. You are
asked to compare distributions from two different files: the Run-2 MC for the Z' sample and the
Run-3 MC for the Z' sample.</p>
<p>For this task, you will:</p>
<ol>
<li>Download the Z' sample for the Run-3 MC <code>zpext_run3.h5</code> from <code>/eos/user/u/umamibot/tutorials/</code>
   or from <code>https://umami-ci-provider.web.cern.ch/puma/zpext_run3.h5</code>.</li>
<li>Write a plotting script to compare the <code>averageInteractionsPerCrossing</code> between the two samples.</li>
</ol>
<details class="warning">
<summary>Solution</summary>
<p>Copy the Run-3 MC file (assuming you work on lxplus):</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>/eos/user/u/umamibot/tutorials/zpext_run3.h5<span class="w"> </span>&lt;/path/to/tutorial/data/&gt;
</code></pre></div>
<p>If you don't work on lxplus, download it via</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://umami-ci-provider.web.cern.ch/puma/zpext_run3.h5
</code></pre></div>
<p>You should provide a path for the dummy <code>&lt;/path/to/tutorial/data/&gt;</code> in the command above and in the
python example below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">puma</span><span class="w"> </span><span class="kn">import</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">HistogramPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.hdf5</span><span class="w"> </span><span class="kn">import</span> <span class="n">H5Reader</span>

<span class="c1"># load the &quot;jets&quot; datasets from the h5 files</span>
<span class="n">filepath_run2</span> <span class="o">=</span> <span class="s2">&quot;zpext.h5&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">H5Reader</span><span class="p">(</span><span class="n">filepath_run2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">jets_run2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">]</span>

<span class="n">filepath_run3</span> <span class="o">=</span> <span class="s2">&quot;zpext_run3.h5&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">H5Reader</span><span class="p">(</span><span class="n">filepath_run3</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">jets_run3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">]</span>

<span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;averageInteractionsPerCrossing&quot;</span>
<span class="n">run_2</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">jets_run2</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Run 2 MC&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">run_3</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">jets_run3</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Run 3 MC&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Initialise histogram plot</span>
<span class="n">plot_histo</span> <span class="o">=</span> <span class="n">HistogramPlot</span><span class="p">(</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of events&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;average interactions per crossing $\langle\mu\rangle$ [a.u.]&quot;</span><span class="p">,</span>
    <span class="n">logy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">atlas_first_tag</span><span class="o">=</span><span class="s2">&quot;Simulation Internal&quot;</span><span class="p">,</span>
    <span class="n">atlas_second_tag</span><span class="o">=</span><span class="s2">&quot;Example for a comparison plot&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add histograms and plot</span>
<span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">run_2</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">run_3</span><span class="p">)</span>
<span class="n">plot_histo</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="n">plot_histo</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;histogram_pileup.png&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="compare-the-flipped-taggers-to-the-regular-flavour-tagging-algorithms">Compare the "Flipped Taggers" to the Regular Flavour Tagging Algorithms<a class="headerlink" href="#compare-the-flipped-taggers-to-the-regular-flavour-tagging-algorithms" title="Permanent link">#</a></h3>
<p>This task further extends over the simple histogram plotting you already encountered in Task 1. You
are asked to compare distributions from a regular flavour tagging algorithm and a so-called "flipped
tagger", which is a modified version of the flavour tagging algorithm used for light-jet mistag
calibration. For this version, the sign of <span class="arithmatex"><span class="MathJax_Preview">d_0</span><script type="math/tex">d_0</script></span>/<span class="arithmatex"><span class="MathJax_Preview">z_0</span><script type="math/tex">z_0</script></span> signed impact parameter is flipped, resulting
in a selection of jets with “negative lifetime”.</p>
<p>Consequently, the flipped tagger's <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tagging efficiency is reduced while its light-jet mistag rate
is left unchanged.</p>
<p>For this task, you will:</p>
<ol>
<li>Write a plotting script to compare the scores <span class="arithmatex"><span class="MathJax_Preview">p_b</span><script type="math/tex">p_b</script></span>, <span class="arithmatex"><span class="MathJax_Preview">p_c</span><script type="math/tex">p_c</script></span>, and <span class="arithmatex"><span class="MathJax_Preview">p_u</span><script type="math/tex">p_u</script></span>, for the RNNIP tagger to
   the flipped version. You should produce three plots, one for each score (such as <span class="arithmatex"><span class="MathJax_Preview">p_b</span><script type="math/tex">p_b</script></span>), which
   show the distributions of the RNNIP tagger and the flipped RNNIP tagger overlaid for the three
   different jet flavours <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets, <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jets and light-flavour jets.</li>
<li>Next, extend the script to compare also the flavour tagging discriminant based on the flipped
   tagger and the regular RNNIP tagger. You should produce one plot which compares the distributions
   of the RNNIP tagger and the flipped RNNIP tagger overlaid for the three different jet flavours
   <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-jets, <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>-jets and light-flavour jets.</li>
</ol>
<details class="info">
<summary>Hint: Names of the RNNIP tagger and the flipped tagger scores and the corresponding <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>-tagging discriminant</summary>
<p>The names of the RNNIP tagger scores are</p>
<ul>
<li><code>rnnip_pu</code></li>
<li><code>rnnip_pc</code></li>
<li><code>rnnip_pb</code></li>
</ul>
<p>The names of the flipped version are</p>
<ul>
<li><code>rnnipflip_pu</code></li>
<li><code>rnnipflip_pc</code></li>
<li><code>rnnipflip_pb</code></li>
</ul>
<p>An example how the discriminant can be calculated is provided in <a href="https://github.com/umami-hep/puma/blob/main/examples/plot_discriminant_scores.py">one of the puma example scripts</a>.</p>
</details>
<details class="warning">
<summary>Solution</summary>
<p>You should provide the path for the dummy <code>&lt;/path/to/tutorial/data/&gt;</code> in the python example below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">puma</span><span class="w"> </span><span class="kn">import</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">HistogramPlot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_discriminant</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flavours</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftag.hdf5</span><span class="w"> </span><span class="kn">import</span> <span class="n">H5Reader</span>

<span class="c1"># load the &quot;jets&quot; dataset from the h5 file</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;/path/to/tutorial/data/ttbar.h5&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">H5Reader</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">jets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jets&quot;</span><span class="p">]</span>
<span class="n">jets_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">jets</span><span class="p">)</span>


<span class="c1"># defining boolean arrays to select the different flavour classes</span>
<span class="n">is_light</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">is_c</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">is_b</span> <span class="o">=</span> <span class="n">jets</span><span class="p">[</span><span class="s2">&quot;HadronConeExclTruthLabelID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span>


<span class="c1"># Calculate discriminant scores for RNNIP and flipped tagger, and add them to the dataframe</span>

<span class="n">jets_df</span><span class="p">[</span><span class="s2">&quot;disc_rnnip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;rnnip&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.93</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">jets_df</span><span class="p">[</span><span class="s2">&quot;disc_rnnipflip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_discriminant</span><span class="p">(</span>
    <span class="n">jets</span><span class="o">=</span><span class="n">jets</span><span class="p">,</span>
    <span class="n">tagger</span><span class="o">=</span><span class="s2">&quot;rnnipflip&quot;</span><span class="p">,</span>
    <span class="n">signal</span><span class="o">=</span><span class="n">Flavours</span><span class="p">[</span><span class="s2">&quot;bjets&quot;</span><span class="p">],</span>
    <span class="n">flavours</span><span class="o">=</span><span class="n">Flavours</span><span class="o">.</span><span class="n">by_category</span><span class="p">(</span><span class="s2">&quot;single-btag&quot;</span><span class="p">),</span>
    <span class="n">fraction_values</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fc&quot;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>
        <span class="s2">&quot;fu&quot;</span><span class="p">:</span> <span class="mf">0.93</span><span class="p">,</span>
        <span class="s2">&quot;ftau&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;rnnip_pu&#39;</span><span class="p">,</span> <span class="s1">&#39;rnnipflip_pu&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rnnip_pc&#39;</span><span class="p">,</span> <span class="s1">&#39;rnnipflip_pc&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rnnip_pb&#39;</span><span class="p">,</span> <span class="s1">&#39;rnnipflip_pb&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;disc_rnnip&#39;</span><span class="p">,</span> <span class="s1">&#39;disc_rnnipflip&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">axis_labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;rnnip_pu&#39;</span><span class="p">:</span> <span class="s1">&#39;RNNIP $p_</span><span class="se">\\</span><span class="s1">mathrm</span><span class="si">{light}</span><span class="s1">$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rnnip_pc&#39;</span><span class="p">:</span> <span class="s1">&#39;RNNIP $p_</span><span class="si">{c}</span><span class="s1">$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rnnip_pb&#39;</span><span class="p">:</span> <span class="s1">&#39;RNNIP $p_</span><span class="si">{b}</span><span class="s1">$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;disc_rnnip&#39;</span><span class="p">:</span> <span class="s1">&#39;RNNIP $b$-tagging discriminant&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># plot score and discriminantdistributions</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">rnnip_light</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_light</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;ujet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rnnip_c</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_c</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;cjet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rnnip_b</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_b</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;bjet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">rnnip_light_flip</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_light</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;ujets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP (flip)&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;ujet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rnnip_c_flip</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_c</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;cjets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP (flip)&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;cjet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rnnip_b_flip</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
        <span class="n">jets_df</span><span class="p">[</span><span class="n">is_b</span><span class="p">][</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="n">flavour</span><span class="o">=</span><span class="s2">&quot;bjets&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RNNIP (flip)&quot;</span><span class="p">,</span>
        <span class="n">ratio_group</span><span class="o">=</span><span class="s2">&quot;bjet&quot;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;disc_rnnip&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Initialise histogram plot</span>
    <span class="n">plot_histo</span> <span class="o">=</span> <span class="n">HistogramPlot</span><span class="p">(</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of events&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_labels</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">atlas_first_tag</span><span class="o">=</span><span class="s2">&quot;Simulation Internal&quot;</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">n_ratio_panels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add histograms and plot</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_light</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_c</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_b</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_light_flip</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_c_flip</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rnnip_b_flip</span><span class="p">)</span>
    <span class="n">plot_histo</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">plot_histo</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;histogram_flip_</span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</details>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 29, 2025 14:47:31 UTC">October 29, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 29, 2025 14:47:31 UTC">October 29, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2023 CERN for the benefit of the ATLAS collaboration
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>